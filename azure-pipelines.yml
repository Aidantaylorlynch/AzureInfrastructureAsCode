trigger:
  - master

stages:
  - stage: Copy
    displayName: COPY ARM template to staging
    jobs:
     - job: Copy
       displayName: COPY
       pool:
        vmImage: 'ubuntu-16.04'
       steps:
         - task: PublishBuildArtifacts@1
           inputs:
             PathtoPublish: $(Build.SourcesDirectory)/ARMTemplates
             ArtifactName: ARMTemplates

  - stage: Deploy
    displayName: Deploy ARM template
    jobs:
      - job: Deploy
        displayName: Deploy
        pool:
          vmImage: 'ubuntu-16.04'
        steps:
          - task: AzureResourceGroupDeployment@2
            inputs:
              azureSubscription: ARMServiceConnection
              action: Create Or Update Resource Group
              deploymentMode: Complete
              resourceGroupName: Multi
              templateLocation: Linked artifact    
              csmFile: $(Build.SourcesDirectory)/ARMTemplates/azuredeploy.json)          